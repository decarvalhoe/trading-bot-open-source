<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Designer de stratégies</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="layout__header">
      <nav class="app-nav" aria-label="Navigation principale">
        <a
          href="{{ request.url_for('render_dashboard') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'dashboard' else '' }}"
          aria-current="{{ 'page' if active_page == 'dashboard' else 'false' }}"
        >
          Tableau de bord
        </a>
        <a
          href="{{ request.url_for('render_marketplace') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'marketplace' else '' }}"
          aria-current="{{ 'page' if active_page == 'marketplace' else 'false' }}"
        >
          Marketplace
        </a>
        <a
          href="{{ request.url_for('render_follower_dashboard') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'followers' else '' }}"
          aria-current="{{ 'page' if active_page == 'followers' else 'false' }}"
        >
          Suivi copies
        </a>
        <a
          href="{{ request.url_for('render_strategies') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'strategies' else '' }}"
          aria-current="{{ 'page' if active_page == 'strategies' else 'false' }}"
        >
          Stratégies
        </a>
        <a
          href="{{ request.url_for('render_strategy_documentation') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'strategy-docs' else '' }}"
          aria-current="{{ 'page' if active_page == 'strategy-docs' else 'false' }}"
        >
          Documentation stratégies
        </a>
        <a
          href="{{ request.url_for('render_help_center') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'help' else '' }}"
          aria-current="{{ 'page' if active_page == 'help' else 'false' }}"
        >
          Aide &amp; formation
        </a>
        <a
          href="{{ request.url_for('render_account') }}"
          class="app-nav__link {{ 'app-nav__link--active' if active_page == 'account' else '' }}"
          aria-current="{{ 'page' if active_page == 'account' else 'false' }}"
        >
          Compte &amp; API
        </a>
      </nav>
      <h1 class="heading heading--xl">Composer une stratégie</h1>
      <p class="text text--muted">
        Assemblez conditions, indicateurs et actions avant d'envoyer votre stratégie vers l'algo-engine.
      </p>
    </header>
    <main class="layout__main layout__main--wide">
      <section class="card card--designer" aria-labelledby="designer-card-title">
        <div class="card__header">
          <h2 id="designer-card-title" class="heading heading--lg">Éditeur visuel</h2>
          <p class="text text--muted">
            Faites glisser les blocs depuis la bibliothèque pour créer votre logique et déclencher des exécutions.
          </p>
        </div>
        <div class="card__body">
          <div
            id="strategy-designer-root"
            data-save-endpoint="{{ save_endpoint }}"
            data-default-name="Nouvelle stratégie"
            data-default-format="yaml"
            data-presets='{{ presets | tojson }}'
            {% if initial_strategy %}
            data-initial-strategy='{{ initial_strategy | tojson }}'
            {% endif %}
          >
            <noscript>
              <p class="text text--muted">
                Activez JavaScript pour utiliser le designer de stratégies.
              </p>
            </noscript>
          </div>
        </div>
      </section>

      <section class="card card--import" aria-labelledby="import-card-title">
        <div class="card__header">
          <h2 id="import-card-title" class="heading heading--lg">Importer un fichier</h2>
          <p class="text text--muted">
            Téléversez un fichier YAML ou Python existant pour l'envoyer directement vers l'algo-engine.
          </p>
        </div>
        <div class="card__body">
          <form
            class="import-form"
            action="{{ upload_endpoint }}"
            method="post"
            enctype="multipart/form-data"
          >
            <div class="import-form__fields">
              <label class="designer-field">
                <span class="designer-field__label text text--muted">Nom (optionnel)</span>
                <input type="text" name="name" placeholder="Ma stratégie existante" />
              </label>
              <label class="designer-field">
                <span class="designer-field__label text text--muted">Fichier YAML/Python</span>
                <input
                  type="file"
                  name="file"
                  required
                  accept=".yaml,.yml,.py,.json,.txt"
                />
              </label>
            </div>
            <button type="submit" class="button button--primary">Importer dans l'algo-engine</button>
          </form>
          <div class="import-presets" role="region" aria-labelledby="preset-catalog-title">
            <h3 id="preset-catalog-title" class="heading heading--md">Modèles disponibles</h3>
            <ul>
              {% for preset in preset_summaries %}
              <li>
                <strong>{{ preset.label }}</strong>
                <span class="text text--muted"> — {{ preset.description }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </section>

      <section class="card card--backtest" aria-labelledby="backtest-card-title">
        <div class="card__header">
          <h2 id="backtest-card-title" class="heading heading--lg">Backtests</h2>
          <p class="text text--muted">
            Sélectionnez un actif et une période pour exécuter un backtest et visualiser l'équity.
          </p>
        </div>
        <div class="card__body">
          <div
            id="strategy-backtest-root"
            data-strategies-endpoint="{{ backtest_config.strategies_endpoint }}"
            data-run-endpoint-template="{{ backtest_config.run_endpoint_template }}"
            data-ui-endpoint-template="{{ backtest_config.ui_endpoint_template }}"
            data-history-endpoint-template="{{ backtest_config.history_endpoint_template }}"
            data-history-page-size="5"
            data-default-symbol="BTCUSDT"
            data-tradingview-config-endpoint="/config/tradingview"
            data-tradingview-update-endpoint="/config/tradingview"
          >
            <noscript>
              <p class="text text--muted">
                Activez JavaScript pour lancer des backtests interactifs.
              </p>
            </noscript>
          </div>
        </div>
      </section>

      <section class="card card--assistant" aria-labelledby="assistant-card-title">
        <div class="card__header">
          <h2 id="assistant-card-title" class="heading heading--lg">Assistant IA</h2>
          <p class="text text--muted">
            Décrivez votre idée en langage naturel pour obtenir un brouillon de stratégie prêt à être importé.
          </p>
        </div>
        <div class="card__body">
          <div
            id="ai-strategy-assistant-root"
            data-generate-endpoint="{{ ai_generate_endpoint }}"
            data-import-endpoint="{{ ai_import_endpoint }}"
          >
            <noscript>
              <p class="text text--muted">
                Activez JavaScript pour utiliser l'assistant IA.
              </p>
            </noscript>
          </div>
        </div>
      </section>
    </main>
    <footer class="layout__footer">
      <p class="text text--muted">Conçu pour rester compatible avec /strategies/import de l'algo-engine.</p>
    </footer>
    <script type="module" src="/static/dist/portfolio-chart.js"></script>
  </body>
</html>
