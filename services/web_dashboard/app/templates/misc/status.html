<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>État des services</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
      table { border-collapse: collapse; min-width: 480px; }
      td, th { padding: .6rem .8rem; border-bottom: 1px solid #eee; text-align: left; }
      .ok { color: #0a7a0a; font-weight: 600; }
      .ko { color: #b00020; font-weight: 600; }
      a { color: #0a5bd9; text-decoration: none; }
    </style>
  </head>
  <body>
    <h1>État des services</h1>
    <table>
      <thead>
        <tr><th>Service</th><th>Statut</th><th>Endpoint</th></tr>
      </thead>
      <tbody>
        {% for name, up in services.items() %}
          {% set service_names = {
            'auth': 'Service d\'authentification',
            'reports': 'Service de rapports', 
            'algo': 'Moteur algorithmique',
            'router': 'Routeur d\'ordres',
            'market': 'Données de marché'
          } %}
          <tr>
            <td>{{ service_names.get(name, name) }}</td>
            <td class="{{ 'ok' if up else 'ko' }}">
              {% if up %}
                <span class="badge badge--success">UP</span>
              {% else %}
                {% if status_codes[name] %}
                  <span class="badge badge--critical">HTTP {{ status_codes[name] }} - Indisponible</span>
                {% else %}
                  <span class="badge badge--critical">Indisponible</span>
                {% endif %}
              {% endif %}
            </td>
            <td><a href="{{ targets[name] }}" target="_blank">{{ targets[name] }}</a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <p style="margin-top:1rem;"><a href="{{ request.url_for('render_account_register') }}">Créer un compte</a></p>
  </body>
</html>
